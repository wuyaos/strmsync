# docker-compose.yml
version: '3.8'

services:
  strmsync:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: strmsync
    ports:
      - "${PORT:-3000}:3000"
    volumes:
      # 数据目录
      - ./data:/app/data
      # 日志目录
      - ./logs:/app/logs
      # 媒体源挂载（只读）
      - ${MEDIA_PATH_1}:/media/source1:ro
      - ${MEDIA_PATH_2}:/media/source2:ro
      - ${MEDIA_PATH_3}:/media/source3:ro
      # STRM 输出目录
      - ${STRM_OUTPUT_PATH}:/media/library
    environment:
      # 基础配置
      - TZ=${TZ:-Asia/Shanghai}
      - LOG_LEVEL=${LOG_LEVEL:-info}

      # 安全配置
      - ENCRYPTION_KEY=${ENCRYPTION_KEY:-change-me-to-random-32-chars!!}

      # 数据库配置
      - DB_PATH=/app/data/strmsync.db

      # 服务端口
      - PORT=3000
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:3000/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
