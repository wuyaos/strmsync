#!/usr/bin/env bash
set -euo pipefail

ver="$(tr -d '[:space:]' < VERSION)"
if [[ -z "${ver}" ]]; then
  echo "VERSION 为空，跳过 README 徽章更新。"
  exit 0
fi

if ! grep -q "Version-" README.md; then
  echo "README 未找到 Version 徽章，跳过。"
  exit 0
fi

if ! command -v perl >/dev/null 2>&1; then
  echo "错误: 未找到 perl 命令，无法更新徽章。请安装 perl 或联系维护者。"
  exit 1
fi

perl -pi -e "s/Version-[0-9A-Za-z.-]+-fb7299/Version-${ver}-fb7299/g" README.md
git add README.md
