# STRMSync å¼€å‘è„šæœ¬ä½¿ç”¨æŒ‡å—

## ğŸ“‚ è„šæœ¬åˆ—è¡¨

| è„šæœ¬ | è¯´æ˜ | ç”¨é€” |
|------|------|------|
| `dev-start.sh` | å¯åŠ¨å¼€å‘ç¯å¢ƒ | å‰åç«¯ä¸€èµ·å¯åŠ¨ï¼ˆæµ‹è¯•æ¨¡å¼ï¼‰ |
| `dev-stop.sh` | åœæ­¢å¼€å‘ç¯å¢ƒ | åœæ­¢æ‰€æœ‰è¿›ç¨‹å¹¶æ¸…ç†ç«¯å£ |
| `dev-restart.sh` | é‡å¯å¼€å‘ç¯å¢ƒ | å…ˆåœæ­¢å†å¯åŠ¨ï¼ˆè§£å†³ç«¯å£å ç”¨ï¼‰ |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨å¼€å‘ç¯å¢ƒ

```bash
cd /path/to/strm
./scripts/dev-start.sh
```

**ç‰¹æ€§**ï¼š
- âœ… è‡ªåŠ¨åŠ è½½ `tests/.env.test` é…ç½®
- âœ… åœ¨ `tests/` ç›®å½•è¿è¡Œï¼ˆéš”ç¦»æµ‹è¯•ç¯å¢ƒï¼‰
- âœ… åç«¯ç«¯å£ï¼š`3000`ï¼ˆç”± .env.test é…ç½®ï¼‰
- âœ… å‰ç«¯ç«¯å£ï¼š`5676`
- âœ… è‡ªåŠ¨æ£€æŸ¥ç«¯å£å ç”¨
- âœ… ç­‰å¾…æœåŠ¡å¯åŠ¨å¹¶éªŒè¯å¥åº·çŠ¶æ€
- âœ… åå°è¿è¡Œï¼Œæ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶

**å¯åŠ¨åè®¿é—®**ï¼š
- ğŸ¨ å‰ç«¯ç•Œé¢ï¼šhttp://localhost:5676
- ğŸ”§ åç«¯ APIï¼šhttp://localhost:3000/api/health

**æ—¥å¿—æŸ¥çœ‹**ï¼š
```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—
tail -f tests/logs/backend.log

# æŸ¥çœ‹å‰ç«¯æ—¥å¿—
tail -f tests/logs/frontend.log
```

---

### 2. åœæ­¢å¼€å‘ç¯å¢ƒ

```bash
./scripts/dev-stop.sh
```

**åŠŸèƒ½**ï¼š
- âœ… æ ¹æ® PID æ–‡ä»¶åœæ­¢åç«¯å’Œå‰ç«¯
- âœ… ç­‰å¾…è¿›ç¨‹ä¼˜é›…é€€å‡ºï¼ˆ10ç§’è¶…æ—¶ï¼‰
- âœ… è¶…æ—¶åå¼ºåˆ¶ kill -9
- âœ… æ¸…ç†æ‰€æœ‰ç«¯å£å ç”¨ï¼ˆåŒ…æ‹¬é—ç•™è¿›ç¨‹ï¼‰
- âœ… åˆ é™¤ PID æ–‡ä»¶

---

### 3. é‡å¯å¼€å‘ç¯å¢ƒ

```bash
./scripts/dev-restart.sh
```

**é€‚ç”¨åœºæ™¯**ï¼š
- ğŸ”„ ä¿®æ”¹ä»£ç åéœ€è¦é‡å¯
- ğŸ› è¿›ç¨‹åƒµæ­»éœ€è¦å¼ºåˆ¶é‡å¯
- âš ï¸ ç«¯å£è¢«å ç”¨æ— æ³•å¯åŠ¨

**ç­‰æ•ˆäº**ï¼š
```bash
./scripts/dev-stop.sh
sleep 1
./scripts/dev-start.sh
```

---

## âš™ï¸ é…ç½®æ–‡ä»¶

### tests/.env.test

æµ‹è¯•ç¯å¢ƒé…ç½®ï¼Œä¸»è¦å‚æ•°ï¼š

```bash
# åç«¯ç«¯å£ï¼ˆä¸ç”Ÿäº§ç¯å¢ƒéš”ç¦»ï¼‰
PORT=3000

# æµ‹è¯•æ•°æ®åº“ï¼ˆç‹¬ç«‹äºç”Ÿäº§æ•°æ®ï¼‰
DB_PATH=data/test.db

# è°ƒè¯•æ—¥å¿—
LOG_LEVEL=debug

# æµ‹è¯•ç”¨åŠ å¯†å¯†é’¥
ENCRYPTION_KEY=test_encryption_key_12345678
```

### frontend/vite.config.js

å‰ç«¯ä¼šæ ¹æ®ç¯å¢ƒå˜é‡åŠ¨æ€é…ç½®åç«¯ä»£ç†ï¼š

```javascript
proxy: {
  '/api': {
    target: process.env.VITE_BACKEND_PORT
      ? `http://localhost:${process.env.VITE_BACKEND_PORT}`
      : 'http://localhost:6754',  // é»˜è®¤ç”Ÿäº§ç«¯å£
    changeOrigin: true
  }
}
```

---

## ğŸ“ ç›®å½•ç»“æ„

```
strm/
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ dev-start.sh      # å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ dev-stop.sh       # åœæ­¢è„šæœ¬
â”‚   â””â”€â”€ dev-restart.sh    # é‡å¯è„šæœ¬
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ .env.test         # æµ‹è¯•ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ data/             # æµ‹è¯•æ•°æ®åº“ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”‚   â”œâ”€â”€ logs/             # æ—¥å¿—ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”‚   â”‚   â”œâ”€â”€ backend.log   # åç«¯æ—¥å¿—
â”‚   â”‚   â””â”€â”€ frontend.log  # å‰ç«¯æ—¥å¿—
â”‚   â”œâ”€â”€ backend.pid       # åç«¯è¿›ç¨‹ PID
â”‚   â””â”€â”€ frontend.pid      # å‰ç«¯è¿›ç¨‹ PID
â”‚
â”œâ”€â”€ backend/
â”‚   â””â”€â”€ .env              # ä¸´æ—¶ï¼šå¤åˆ¶è‡ª tests/.env.test
â”‚
â””â”€â”€ frontend/
    â””â”€â”€ vite.config.js    # æ”¯æŒç¯å¢ƒå˜é‡é…ç½®
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šç«¯å£è¢«å ç”¨

**ç°è±¡**ï¼š
```
âš  è­¦å‘Š: åç«¯ ç«¯å£ 3000 å·²è¢«å ç”¨
âœ— ç«¯å£æ£€æŸ¥å¤±è´¥ï¼Œè¯·å…ˆåœæ­¢å ç”¨ç«¯å£çš„è¿›ç¨‹
```

**è§£å†³**ï¼š
```bash
# æ–¹æ¡ˆ1ï¼šä½¿ç”¨é‡å¯è„šæœ¬ï¼ˆæ¨èï¼‰
./scripts/dev-restart.sh

# æ–¹æ¡ˆ2ï¼šæ‰‹åŠ¨æ¸…ç†
./scripts/dev-stop.sh
./scripts/dev-start.sh

# æ–¹æ¡ˆ3ï¼šæ‰‹åŠ¨æŸ¥æ‰¾å¹¶æ€æ­»è¿›ç¨‹
lsof -ti :3000 | xargs kill -9
lsof -ti :5676 | xargs kill -9
```

---

### é—®é¢˜ 2ï¼šåç«¯å¯åŠ¨è¶…æ—¶

**ç°è±¡**ï¼š
```
ç­‰å¾…åç«¯å°±ç»ª......âœ—
âœ— åç«¯å¯åŠ¨è¶…æ—¶ï¼ŒæŸ¥çœ‹æ—¥å¿—: tests/logs/backend.log
```

**æ’æŸ¥**ï¼š
```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—
cat tests/logs/backend.log

# å¸¸è§åŸå› ï¼š
# - æ•°æ®åº“æ–‡ä»¶æƒé™é—®é¢˜
# - .env.test é…ç½®é”™è¯¯
# - Go ä¾èµ–æœªå®‰è£…

# æ‰‹åŠ¨å¯åŠ¨åç«¯è°ƒè¯•
cd backend
go run ./cmd/server
```

---

### é—®é¢˜ 3ï¼šå‰ç«¯å¯åŠ¨è¶…æ—¶

**ç°è±¡**ï¼š
```
ç­‰å¾…å‰ç«¯å°±ç»ª......âœ—
âœ— å‰ç«¯å¯åŠ¨è¶…æ—¶ï¼ŒæŸ¥çœ‹æ—¥å¿—: tests/logs/frontend.log
```

**æ’æŸ¥**ï¼š
```bash
# æŸ¥çœ‹å‰ç«¯æ—¥å¿—
cat tests/logs/frontend.log

# å¸¸è§åŸå› ï¼š
# - npm ä¾èµ–æœªå®‰è£…
# - node ç‰ˆæœ¬è¿‡ä½ï¼ˆéœ€è¦ 18+ï¼‰
# - vite ç«¯å£è¢«å ç”¨

# æ‰‹åŠ¨å¯åŠ¨å‰ç«¯è°ƒè¯•
cd frontend
npm install
npm run dev
```

---

### é—®é¢˜ 4ï¼šè¿›ç¨‹æ— æ³•åœæ­¢

**ç°è±¡**ï¼šåœæ­¢è„šæœ¬æ‰§è¡Œåè¿›ç¨‹ä»åœ¨è¿è¡Œ

**è§£å†³**ï¼š
```bash
# å¼ºåˆ¶åœæ­¢æ‰€æœ‰ç›¸å…³è¿›ç¨‹
pkill -9 -f "strmsync"
pkill -9 -f "cmd/server"
pkill -9 -f "vite.*frontend"

# æ¸…ç†ç«¯å£å ç”¨
lsof -ti :3000 | xargs kill -9
lsof -ti :5676 | xargs kill -9
```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æµ‹è¯•ç¯å¢ƒéš”ç¦»**
   - æµ‹è¯•ç¯å¢ƒä½¿ç”¨ç‹¬ç«‹ç«¯å£ï¼ˆ3000ï¼‰å’Œæ•°æ®åº“ï¼ˆdata/test.dbï¼‰
   - ä¸ä¼šå½±å“ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆç«¯å£ 6754ï¼Œapp/data.dbï¼‰

2. **æ—¥å¿—æŒä¹…åŒ–**
   - åå°è¿è¡Œçš„æ—¥å¿—ä¿å­˜åœ¨ `tests/logs/` ç›®å½•
   - æ¯æ¬¡å¯åŠ¨ä¸ä¼šæ¸…ç©ºæ—§æ—¥å¿—ï¼ˆéœ€æ‰‹åŠ¨æ¸…ç†ï¼‰

3. **PID æ–‡ä»¶ç®¡ç†**
   - PID æ–‡ä»¶ç”¨äºè¿›ç¨‹ç®¡ç†ï¼Œåœæ­¢è„šæœ¬ä¼šè‡ªåŠ¨æ¸…ç†
   - å¦‚æœå¼‚å¸¸é€€å‡ºå¯¼è‡´ PID æ–‡ä»¶æ®‹ç•™ï¼Œå¯æ‰‹åŠ¨åˆ é™¤ï¼š
     ```bash
     rm -f tests/*.pid
     ```

4. **ç¯å¢ƒå˜é‡ä¼ é€’**
   - `dev-start.sh` ä¼šè®¾ç½® `VITE_BACKEND_PORT` ç¯å¢ƒå˜é‡
   - Vite ä¼šè¯»å–è¯¥å˜é‡å¹¶é…ç½®ä»£ç†åˆ°æµ‹è¯•ç¯å¢ƒåç«¯

5. **æ•°æ®æŒä¹…æ€§**
   - æµ‹è¯•æ•°æ®åº“ `tests/data/test.db` ä¼šæŒä¹…ä¿å­˜
   - å¦‚éœ€å…¨æ–°æµ‹è¯•ç¯å¢ƒï¼Œåˆ é™¤æ•°æ®åº“å³å¯ï¼š
     ```bash
     rm -f tests/data/test.db
     ```

---

## ğŸ¯ å…¸å‹å·¥ä½œæµ

### æ—¥å¸¸å¼€å‘

```bash
# 1. å¯åŠ¨å¼€å‘ç¯å¢ƒ
./scripts/dev-start.sh

# 2. è®¿é—®å‰ç«¯è¿›è¡Œæµ‹è¯•
open http://localhost:5676

# 3. æŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼ˆå¯é€‰ï¼‰
tail -f tests/logs/backend.log

# 4. ä¿®æ”¹ä»£ç åé‡å¯
./scripts/dev-restart.sh

# 5. ç»“æŸå¼€å‘ï¼Œåœæ­¢æœåŠ¡
./scripts/dev-stop.sh
```

### è°ƒè¯•åç«¯

```bash
# 1. åœæ­¢å¼€å‘ç¯å¢ƒ
./scripts/dev-stop.sh

# 2. æ‰‹åŠ¨å¯åŠ¨å‰ç«¯
cd frontend
npm run dev &

# 3. æ‰‹åŠ¨å¯åŠ¨åç«¯ï¼ˆå¯æ‰“æ–­ç‚¹ï¼‰
cd ../backend
cp ../tests/.env.test .env
go run ./cmd/server

# 4. è°ƒè¯•å®Œæˆåå…¨éƒ¨åœæ­¢
./scripts/dev-stop.sh
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [HTTP API æ–‡æ¡£](../docs/HTTP_API.md)
- [éƒ¨ç½²æ–‡æ¡£](../docs/DEPLOYMENT.md)
- [æµ‹è¯•æŒ‡å—](../TESTING_GUIDE.md)

---

**æœ€åæ›´æ–°**: 2026-02-19
**ç»´æŠ¤è€…**: STRMSync Team
