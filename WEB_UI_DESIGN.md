# STRMSync Web 界面设计

## 整体布局

采用 **左侧导航 + 右侧内容区** 的经典布局。

```
┌──────────────────────────────────────────────────────────────┐
│  STRMSync                         [用户] [设置] [日志] [帮助]│
├────────┬─────────────────────────────────────────────────────┤
│        │                                                      │
│  导航  │                内容区                                │
│        │                                                      │
│  [图标]│                                                      │
│  仪表盘│                                                      │
│        │                                                      │
│  数据源│                                                      │
│        │                                                      │
│  任务  │                                                      │
│        │                                                      │
│  文件  │                                                      │
│        │                                                      │
│  设置  │                                                      │
│        │                                                      │
└────────┴─────────────────────────────────────────────────────┘
```

---

## 页面 1: 仪表盘（Dashboard）

### 布局
```
┌──────────────────────────────────────────────────────────────┐
│  仪表盘                                                        │
├──────────────────────────────────────────────────────────────┤
│  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────┐│
│  │ 总文件数   │ │ STRM 文件  │ │ 活跃数据源 │ │ 运行任务   ││
│  │  85,324    │ │  85,320    │ │   3 / 5    │ │   2 / 5    ││
│  └────────────┘ └────────────┘ └────────────┘ └────────────┘│
│                                                                │
│  ┌─────────────────────────────┐ ┌──────────────────────────┐│
│  │ 系统状态                    │ │ 最近任务                 ││
│  │                             │ │                          ││
│  │ ● 后端服务: 运行中          │ │ ✓ 电影库扫描 (2分钟前)    ││
│  │ ● 数据库: 正常              │ │ ● 剧集监控 (进行中)       ││
│  │ ● 内存使用: 128MB / 512MB   │ │ ✓ 元数据同步 (5分钟前)    ││
│  │ ● CPU: 12%                  │ │ ⚠ Emby 通知失败 (10分钟前)││
│  │                             │ │                          ││
│  └─────────────────────────────┘ └──────────────────────────┘│
│                                                                │
│  ┌────────────────────────────────────────────────────────┐  │
│  │ 文件处理趋势 (最近 7 天)                                │  │
│  │                                                         │  │
│  │  [折线图: 每日新增文件数]                               │  │
│  │                                                         │  │
│  └────────────────────────────────────────────────────────┘  │
│                                                                │
│  ┌─────────────────────────────┐ ┌──────────────────────────┐│
│  │ 数据源状态                  │ │ 快速操作                 ││
│  │                             │ │                          ││
│  │ ✓ 本地电影 (85,320 文件)    │ │ [+ 添加数据源]           ││
│  │ ✓ CD2 剧集 (23,450 文件)    │ │ [▶ 全量扫描]             ││
│  │ ⚠ OpenList 动漫 (连接失败)  │ │ [⚙ 系统设置]             ││
│  │                             │ │ [📊 查看日志]            ││
│  └─────────────────────────────┘ └──────────────────────────┘│
└──────────────────────────────────────────────────────────────┘
```

### 核心组件
1. **统计卡片** (4个)
   - 总文件数
   - STRM 文件数
   - 活跃数据源数
   - 运行中任务数

2. **系统状态面板**
   - 服务运行状态（绿色圆点/红色叉号）
   - 资源使用情况（进度条）

3. **最近任务列表**
   - 任务名称
   - 状态图标（✓ 成功 / ● 进行中 / ⚠ 失败）
   - 时间戳

4. **趋势图表**
   - 最近 7 天每日新增文件数
   - 使用 ECharts 绘制折线图

5. **数据源状态列表**
   - 数据源名称
   - 文件数
   - 状态图标

6. **快速操作按钮**
   - 主要操作的快捷入口

---

## 页面 2: 数据源管理（Sources）

### 布局
```
┌──────────────────────────────────────────────────────────────┐
│  数据源管理                            [+ 添加数据源] [刷新]  │
├──────────────────────────────────────────────────────────────┤
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐│
│  │ 筛选: [全部▼] [本地] [CloudDrive2] [OpenList]            ││
│  │ 状态: [全部▼] [已启用] [已禁用] [错误]                   ││
│  │ 搜索: [___________________] [🔍]                          ││
│  └──────────────────────────────────────────────────────────┘│
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐│
│  │                      数据源列表                           ││
│  ├────┬─────────┬────────┬─────────┬────────┬────────┬──────┤│
│  │ ID │ 名称    │ 类型   │ 源路径  │ 目标路径│ 状态   │ 操作 ││
│  ├────┼─────────┼────────┼─────────┼────────┼────────┼──────┤│
│  │ 1  │本地电影 │ local  │/volume1/│/media/ │✓ 运行中│[编辑]││
│  │    │         │        │Movies   │Movies  │85,320  │[删除]││
│  │    │         │        │         │        │        │[扫描]││
│  ├────┼─────────┼────────┼─────────┼────────┼────────┼──────┤│
│  │ 2  │CD2 剧集 │clouddri│/mnt/cd2/│/media/ │✓ 运行中│[编辑]││
│  │    │         │ve2     │TVShows  │TVShows │23,450  │[删除]││
│  │    │         │        │         │        │        │[扫描]││
│  ├────┼─────────┼────────┼─────────┼────────┼────────┼──────┤│
│  │ 3  │OL 动漫  │openlist│/openlist│/media/ │⚠ 错误  │[编辑]││
│  │    │         │        │/Anime   │Anime   │API连接 │[删除]││
│  │    │         │        │         │        │失败    │[重试]││
│  └────┴─────────┴────────┴─────────┴────────┴────────┴──────┘│
│                                                                │
│  显示 1-3 / 共 5 条                         [< 上一页] [下一页 >]│
└──────────────────────────────────────────────────────────────┘
```

### 添加数据源对话框
```
┌──────────────────────────────────────────────────────────────┐
│  添加数据源                                        [✕ 关闭]   │
├──────────────────────────────────────────────────────────────┤
│                                                                │
│  步骤 1: 选择数据源类型                                       │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐            │
│  │  📁 本地     │ │ ☁️ CloudDrive2│ │ 🌐 OpenList │            │
│  │             │ │              │ │             │            │
│  │  文件系统   │ │  挂载/API   │ │  API 模式  │            │
│  └─────────────┘ └─────────────┘ └─────────────┘            │
│                                                                │
│  步骤 2: 配置参数                                             │
│  ┌──────────────────────────────────────────────────────────┐│
│  │ 基础信息                                                  ││
│  │ 名称:    [___________________________________]            ││
│  │ 源路径:  [___________________________________] [浏览]     ││
│  │ 目标路径:[___________________________________] [浏览]     ││
│  │                                                           ││
│  │ CloudDrive2 配置 (如果选择 CloudDrive2)                   ││
│  │ API 地址: [http://localhost:19798___________]            ││
│  │ API Key:  [***************************]       [显示]     ││
│  │ 模式:     (●) 本地挂载  ( ) API 模式                    ││
│  │ 挂载路径: [/mnt/clouddrive___________________]            ││
│  │                                                           ││
│  │ OpenList 配置 (如果选择 OpenList)                         ││
│  │ API 地址: [http://localhost:5244____________]            ││
│  │ 用户名:   [admin_____________________________]            ││
│  │ 密码:     [***************************]       [显示]     ││
│  │ 代理:     [_________________________________] (可选)      ││
│  │                                                           ││
│  │ 高级选项                                                  ││
│  │ [✓] 启用文件监控                                          ││
│  │ [✓] 自动同步元数据                                        ││
│  │ [✓] 启用此数据源                                          ││
│  │ 排除规则: [.tmp, .@__thumb, *.partial___] (逗号分隔)     ││
│  └──────────────────────────────────────────────────────────┘│
│                                                                │
│  步骤 3: 测试连接                                             │
│  ┌──────────────────────────────────────────────────────────┐│
│  │ ✓ 源路径访问正常                                          ││
│  │ ✓ 目标路径可写                                            ││
│  │ ✓ API 连接成功 (如果使用 API)                             ││
│  └──────────────────────────────────────────────────────────┘│
│                                                                │
│                          [取消]  [测试连接]  [保存]           │
└──────────────────────────────────────────────────────────────┘
```

---

## 页面 3: 任务管理（Tasks）

### 布局
```
┌──────────────────────────────────────────────────────────────┐
│  任务管理                              [+ 新建任务] [刷新]    │
├──────────────────────────────────────────────────────────────┤
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐│
│  │ 筛选: [全部▼] [扫描] [监控] [同步] [通知]                ││
│  │ 状态: [全部▼] [运行中] [已完成] [失败] [等待中]          ││
│  └──────────────────────────────────────────────────────────┘│
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐│
│  │                      任务列表                             ││
│  ├────┬─────────────┬────────┬────────┬────────┬───────┬────┤│
│  │ ID │ 任务名称    │ 类型   │ 数据源 │ 状态   │ 进度  │操作││
│  ├────┼─────────────┼────────┼────────┼────────┼───────┼────┤│
│  │ 1  │全量扫描电影 │ scan   │本地电影│✓ 完成  │100%   │[查看]││
│  │    │2024-02-16   │        │        │85,320  │       │[删除]││
│  │    │15:30        │        │        │文件    │       │    ││
│  ├────┼─────────────┼────────┼────────┼────────┼───────┼────┤│
│  │ 2  │监控剧集目录 │ watch  │CD2剧集 │● 运行中│--     │[查看]││
│  │    │持续运行     │        │        │实时    │       │[停止]││
│  │    │             │        │        │        │       │    ││
│  ├────┼─────────────┼────────┼────────┼────────┼───────┼────┤│
│  │ 3  │同步元数据   │ sync   │本地电影│✓ 完成  │100%   │[查看]││
│  │    │2024-02-16   │        │        │1,234   │       │[重试]││
│  │    │14:20        │        │        │文件    │       │    ││
│  ├────┼─────────────┼────────┼────────┼────────┼───────┼────┤│
│  │ 4  │通知 Emby    │ notify │--      │⚠ 失败  │--     │[查看]││
│  │    │2024-02-16   │        │        │连接超时│       │[重试]││
│  │    │14:15        │        │        │        │       │    ││
│  └────┴─────────────┴────────┴────────┴────────┴───────┴────┘│
│                                                                │
│  显示 1-4 / 共 12 条                        [< 上一页] [下一页 >]│
└──────────────────────────────────────────────────────────────┘
```

### 任务详情面板（点击"查看"展开）
```
┌──────────────────────────────────────────────────────────────┐
│  任务详情 - 全量扫描电影 #1                      [✕ 关闭]    │
├──────────────────────────────────────────────────────────────┤
│                                                                │
│  ┌─────────────────────┐ ┌─────────────────────┐            │
│  │ 任务信息            │ │ 执行统计            │            │
│  │                     │ │                     │            │
│  │ ID: 1               │ │ 开始时间: 15:30:12  │            │
│  │ 类型: 扫描          │ │ 结束时间: 15:38:45  │            │
│  │ 数据源: 本地电影    │ │ 耗时: 8分33秒       │            │
│  │ 状态: 已完成        │ │ 处理速度: 166 文件/秒│            │
│  │ 触发方式: 手动      │ │                     │            │
│  │                     │ │ 扫描文件: 85,320    │            │
│  │                     │ │ 新增: 45            │            │
│  │                     │ │ 更新: 12            │            │
│  │                     │ │ 删除: 3             │            │
│  │                     │ │ 失败: 0             │            │
│  └─────────────────────┘ └─────────────────────┘            │
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐│
│  │ 执行日志                                    [下载完整日志]││
│  ├──────────────────────────────────────────────────────────┤│
│  │ 15:30:12 [INFO] 开始扫描 /volume1/Movies                 ││
│  │ 15:30:15 [INFO] 发现 85,320 个文件                       ││
│  │ 15:32:30 [INFO] 哈希计算完成 (45,234/85,320)             ││
│  │ 15:35:12 [INFO] 生成 STRM 文件 (78,500/85,320)           ││
│  │ 15:37:45 [INFO] 复制元数据 (1,234 文件)                  ││
│  │ 15:38:45 [INFO] 扫描完成                                 ││
│  └──────────────────────────────────────────────────────────┘│
│                                                                │
│                                            [关闭]              │
└──────────────────────────────────────────────────────────────┘
```

---

## 页面 4: 文件浏览（Files）

### 布局
```
┌──────────────────────────────────────────────────────────────┐
│  文件浏览                                          [刷新]     │
├──────────────────────────────────────────────────────────────┤
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐│
│  │ 数据源: [本地电影 ▼]                                     ││
│  │ 路径: / > Movies > Action                                ││
│  │ 搜索: [___________________] [🔍]                          ││
│  └──────────────────────────────────────────────────────────┘│
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐│
│  │                      文件列表                             ││
│  ├──────┬──────────────────────┬──────────┬────────┬────────┤│
│  │ 类型 │ 名称                 │ 大小     │ 修改时间│ STRM  ││
│  ├──────┼──────────────────────┼──────────┼────────┼────────┤│
│  │ 📁   │ Marvel               │ --       │2024-02 │  --    ││
│  │      │                      │          │-15     │        ││
│  ├──────┼──────────────────────┼──────────┼────────┼────────┤│
│  │ 📁   │ DC                   │ --       │2024-02 │  --    ││
│  │      │                      │          │-10     │        ││
│  ├──────┼──────────────────────┼──────────┼────────┼────────┤│
│  │ 🎬   │ Movie Name (2023).mkv│ 12.5 GB  │2024-02 │✓ 已生成││
│  │      │                      │          │-16     │        ││
│  ├──────┼──────────────────────┼──────────┼────────┼────────┤│
│  │ 📄   │ Movie Name.nfo       │ 2.3 KB   │2024-02 │--      ││
│  │      │                      │          │-16     │        ││
│  ├──────┼──────────────────────┼──────────┼────────┼────────┤│
│  │ 🖼️   │ Movie Name-poster.jpg│ 124 KB   │2024-02 │--      ││
│  │      │                      │          │-16     │        ││
│  └──────┴──────────────────────┴──────────┴────────┴────────┘│
│                                                                │
│  显示 1-5 / 共 85,320 条                    [< 上一页] [下一页 >]│
└──────────────────────────────────────────────────────────────┘
```

### 文件详情对话框（双击文件打开）
```
┌──────────────────────────────────────────────────────────────┐
│  文件详情 - Movie Name (2023).mkv                [✕ 关闭]    │
├──────────────────────────────────────────────────────────────┤
│                                                                │
│  ┌─────────────────────┐ ┌─────────────────────┐            │
│  │ 基本信息            │ │ STRM 信息           │            │
│  │                     │ │                     │            │
│  │ 文件名: Movie Name  │ │ 状态: ✓ 已生成      │            │
│  │        (2023).mkv   │ │ 路径: /media/       │            │
│  │ 大小: 12.5 GB       │ │       library/      │            │
│  │ 修改时间: 2024-02-16│ │       Movies/       │            │
│  │          15:45      │ │       Movie.strm    │            │
│  │ 哈希: a3f8b2...     │ │ 内容: /volume1/     │            │
│  │                     │ │       Movies/       │            │
│  │                     │ │       Movie.mkv     │            │
│  │                     │ │ 生成时间: 2024-02-16│            │
│  │                     │ │          15:50      │            │
│  └─────────────────────┘ └─────────────────────┘            │
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐│
│  │ 元数据文件                                                ││
│  ├────────────────────────────────┬───────────┬─────────────┤│
│  │ Movie Name.nfo                 │ 2.3 KB    │ ✓ 已同步    ││
│  │ Movie Name-poster.jpg          │ 124 KB    │ ✓ 已同步    ││
│  │ Movie Name-fanart.jpg          │ 456 KB    │ ✓ 已同步    ││
│  └────────────────────────────────┴───────────┴─────────────┘│
│                                                                │
│  操作: [重新生成 STRM] [重新同步元数据] [查看 STRM 内容]      │
│                                            [关闭]              │
└──────────────────────────────────────────────────────────────┘
```

---

## 页面 5: 系统设置（Settings）

### 布局
```
┌──────────────────────────────────────────────────────────────┐
│  系统设置                                                      │
├──────────────────────────────────────────────────────────────┤
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐│
│  │ [通用设置] [扫描设置] [STRM设置] [通知设置] [高级设置]    ││
│  └──────────────────────────────────────────────────────────┘│
│                                                                │
│  通用设置                                                      │
│  ┌──────────────────────────────────────────────────────────┐│
│  │ 系统名称: [STRMSync_____________________________]         ││
│  │ 时区:     [Asia/Shanghai ▼]                               ││
│  │ 语言:     [简体中文 ▼]                                    ││
│  │ 日志级别: [INFO ▼] (DEBUG/INFO/WARN/ERROR)                ││
│  │ 日志保留: [30__] 天                                       ││
│  └──────────────────────────────────────────────────────────┘│
│                                                                │
│  扫描设置                                                      │
│  ┌──────────────────────────────────────────────────────────┐│
│  │ 并发数:       [50__] Goroutines                           ││
│  │ 批量大小:     [1000__] 条/事务                            ││
│  │ 哈希样本大小: [1__] MB                                    ││
│  │ 定时扫描:     [✓] 启用                                    ││
│  │ Cron 表达式:  [0 2 * * *____________] (每天凌晨2点)       ││
│  │ 排除规则:     [.tmp, .@__thumb, *.partial_____________]   ││
│  │              (逗号分隔)                                    ││
│  └──────────────────────────────────────────────────────────┘│
│                                                                │
│  STRM 设置                                                     │
│  ┌──────────────────────────────────────────────────────────┐│
│  │ 路径格式:     (●) 绝对路径  ( ) 相对路径                 ││
│  │ 编码格式:     [UTF-8 ▼]                                   ││
│  │ 换行符:       [LF ▼] (LF/CRLF)                            ││
│  │ 幂等性检查:   [✓] 启用 (避免重复生成)                    ││
│  └──────────────────────────────────────────────────────────┘│
│                                                                │
│  通知设置                                                      │
│  ┌──────────────────────────────────────────────────────────┐│
│  │ Emby                                                       ││
│  │ [✓] 启用                                                  ││
│  │ URL:     [http://localhost:8096________________]          ││
│  │ API Key: [***************************] [显示] [测试]      ││
│  │                                                           ││
│  │ Plex                                                       ││
│  │ [✓] 启用                                                  ││
│  │ URL:       [http://localhost:32400______________]         ││
│  │ Token:     [***************************] [显示] [测试]    ││
│  │ Section ID:[1__] (媒体库 ID)                              ││
│  │                                                           ││
│  │ Jellyfin                                                   ││
│  │ [ ] 启用                                                  ││
│  │ URL:     [http://localhost:8096________________]          ││
│  │ API Key: [___________________________] [显示] [测试]      ││
│  └──────────────────────────────────────────────────────────┘│
│                                                                │
│  高级设置                                                      │
│  ┌──────────────────────────────────────────────────────────┐│
│  │ API 端口:      [3000__]                                   ││
│  │ 数据库路径:    [/app/data/strmsync.db_______________]     ││
│  │ 最大内存:      [512__] MB                                 ││
│  │ 健康检查间隔:  [30__] 秒                                  ││
│  │ 清理临时文件:  [✓] 启动时清理                            ││
│  └──────────────────────────────────────────────────────────┘│
│                                                                │
│                                    [重置] [测试连接] [保存]   │
└──────────────────────────────────────────────────────────────┘
```

---

## 技术栈

### 前端
- **框架**: Vue 3 (Composition API)
- **UI 库**: Element Plus
- **构建工具**: Vite
- **图表**: ECharts
- **HTTP 客户端**: Axios
- **状态管理**: Pinia
- **路由**: Vue Router

### 后端（仅 API）
- **框架**: Go + Gin
- **数据库**: SQLite + GORM
- **日志**: Zap
- **配置**: Viper
- **文件监控**: fsnotify

---

## 响应式设计

- **桌面**: 1920x1080 及以上（主要目标）
- **平板**: 768x1024 及以上（可选支持）
- **移动端**: 暂不支持

---

## 颜色方案

```css
:root {
  /* 主色调 */
  --primary-color: #409EFF;    /* Element Plus 蓝色 */
  --success-color: #67C23A;    /* 成功绿色 */
  --warning-color: #E6A23C;    /* 警告黄色 */
  --danger-color: #F56C6C;     /* 危险红色 */
  --info-color: #909399;       /* 信息灰色 */

  /* 背景色 */
  --bg-color: #F5F7FA;         /* 浅灰背景 */
  --card-bg: #FFFFFF;          /* 卡片背景 */
  --sidebar-bg: #304156;       /* 侧边栏深蓝灰 */

  /* 文字色 */
  --text-primary: #303133;     /* 主要文字 */
  --text-regular: #606266;     /* 常规文字 */
  --text-secondary: #909399;   /* 次要文字 */

  /* 边框色 */
  --border-color: #DCDFE6;
}
```

---

## 交互细节

### 1. 加载状态
- 使用 Element Plus 的 Loading 组件
- 数据加载时显示骨架屏

### 2. 反馈提示
- 成功操作: 右上角绿色提示（2秒自动关闭）
- 失败操作: 右上角红色提示（5秒自动关闭）
- 警告信息: 右上角黄色提示（3秒自动关闭）

### 3. 确认对话框
- 删除操作: 必须二次确认
- 危险操作: 必须输入确认文本（如"DELETE"）

### 4. 实时更新
- 任务状态: WebSocket 实时推送
- 数据统计: 5秒刷新一次

### 5. 快捷键
- `Ctrl + R`: 刷新当前页面
- `Ctrl + N`: 新建（数据源/任务）
- `Ctrl + S`: 保存设置
- `Esc`: 关闭对话框

---

## API 接口设计（前端调用）

```typescript
// 仪表盘
GET /api/dashboard/stats          // 统计数据
GET /api/dashboard/system          // 系统状态
GET /api/dashboard/recent-tasks    // 最近任务
GET /api/dashboard/trends          // 趋势数据

// 数据源
GET    /api/sources                // 列表
POST   /api/sources                // 创建
PUT    /api/sources/:id            // 更新
DELETE /api/sources/:id            // 删除
POST   /api/sources/:id/scan       // 触发扫描
POST   /api/sources/:id/test       // 测试连接

// 任务
GET    /api/tasks                  // 列表
POST   /api/tasks                  // 创建
GET    /api/tasks/:id              // 详情
DELETE /api/tasks/:id              // 删除
POST   /api/tasks/:id/stop         // 停止
POST   /api/tasks/:id/retry        // 重试
GET    /api/tasks/:id/logs         // 日志

// 文件
GET /api/files                     // 列表
GET /api/files/detail              // 详情
POST /api/files/regenerate-strm    // 重新生成 STRM
POST /api/files/sync-metadata      // 重新同步元数据

// 设置
GET  /api/settings                 // 获取设置
PUT  /api/settings                 // 保存设置
POST /api/settings/test-notify     // 测试通知

// WebSocket
WS /ws/tasks                       // 任务状态实时推送
WS /ws/system                      // 系统状态实时推送
```

---

## 开发优先级

1. **P0 (Critical)**: 仪表盘、数据源管理
2. **P1 (High)**: 任务管理、文件浏览
3. **P2 (Medium)**: 系统设置
4. **P3 (Low)**: 图表、快捷键、WebSocket 实时更新

---

## 下一步

1. 初始化 Vue 3 项目
2. 配置 Element Plus
3. 实现路由和布局
4. 逐页实现核心功能
